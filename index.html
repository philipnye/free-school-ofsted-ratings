<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Free school Ofsted ratings</title>
    <meta name="description" content="The latest Ofsted inspection results for open free schools, updated daily">
    <meta name="author" content="Philip Nye">
    <meta name="robots" content="index, follow"/>       <!-- standard option, made explicit -->
    <meta name="googlebot" content="index, follow"/>    <!-- standard option, made explicit -->
    <meta name="google" content="nositelinkssearchbox"/>      <!-- no search box for site in Google search results -->
    <!-- <link rel="author" href="https://plus.google.com/104452715823590125578"/>       Should appear as author image against page in Google search results -->
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="cookie-pop-up/jquery.cookieBar.js"></script>
    <link rel="stylesheet" href="styling.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="cookie-pop-up/cookieBar.css">

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-61014748-1', 'auto');ga('send', 'pageview');
		</script>

		<script type="text/javascript">
    $(document).ready(function() {
      $('.cookie-message').cookieBar({ closeButton : '.my-close-button' });
    });
    </script>
  </head>
  <body>
    <div class="cookie-message">
    <p>This site uses Google Analytics cookies to record the number of people using it.<a class="my-close-button" href>Accept cookies</a></p>
  	</div>
    <div id="headersSection">
	    <h1>Free school Ofsted ratings</h1>
	    <p id="subhead">Ofsted on free schools. Updated daily.</p>
    </div>
    <div id="navigationSection">
	    <ul id="navigationList">
	        <li class="navigationListItem"><a class="redLink" href="#openSection">Open free schools</a></li>
	        <li class="navigationListItem"><a class="redLink" href="#closedSection">Closed free schools</a></li>
	        <li class="navigationListItem"><a class="redLink" href="#notesSection">Notes on use</a></li>
	    </ul>
	    <p id="lastUpdatedBox"><span id="lastUpdatedHeader">Last updated: </span><span id="lastUpdatedDate"></span></p>
	    <p id="twitterLinkBox"><img id="twitterLogo32" border="0" alt="Twitter logo" src="http://g.twimg.com/dev/documentation/image/Twitter_logo_white_32.png" width="32" height="32"><a href="http://www.twitter.com/FreeSchoolsInfo">@FreeSchoolsInfo</a></p>
    </div>
    <div id="openSection">
        <h2>Open free schools</h2>
        <p>There are currently <span id="openfreeschools"></span> open free schools. Of these, <span id="sec5openfreeschools"></span> have had a section 5 school inspection.</p>
	<p><em><a class="redLink" href="#notesSection">Why don’t post-16 inspections feature in the results?</a></em></p>
	<div id="piesSection" style="overflow:hidden">		<!-- forces table onto fresh row when closing this div -->
		<span id="openPieSpace" style="float:left"></span>
	    <span id="primaryPieSpace" style="float:left"></span>
	    <span id="secondaryPieSpace" style="float:left"></span>
	    <span id="blankPieSpace" style="float:left"></span>
	    <span id="keySpace" style="float:right"></span>
	    <span id="allThroughPieSpace" style="float:left"></span>
	    <span id="apPieSpace" style="float:left"></span>
	    <span id="specialPieSpace" style="float:left"></span>
	</div>
	<div id="openTableSpace"></div>
        <div id="openNotesSpace"></div>
	<span style="float:right"><a class="redLink" href="#headersSection">Back to the top</a></span>
    </div>
    <div id="closedSection">
        <h2>Closed free schools</h2>
        <div id="closedTableSpace"></div>
        <div id="closedNotesSpace"></div>
        <span style="float:right"><a class="redLink" href="#headersSection">Back to the top</a></span>
    </div>
    <div id="notesSection">
        <h2>Notes on use</h2>
        <span style="float:right"><a class="redLink" href="#headersSection">Back to the top</a></span>
        <h3>How does it work?</h3>
        <ul>
            <li>The tool gives the latest Ofsted ratings for free schools, based on data scraped from the Ofsted website.</li>
            <li>Results are generally updated each day, at or around 6am. You can find out when they were last updated by checking the datestamp at the top of the page.</li>
            <li>Only inspections which result in an overall effectiveness rating being awarded or confirmed are included. Results are therefore based on the outcomes of:
				<ul>
					<li>full, section 5 Ofsted inspections;</li>
					<li>short, section 8 inspections which do not convert to a full, section 5 inspection.</li>
				</ul>
			These lead to one of four overall effectiveness ratings: outstanding, good, requires improvement or inadequate.</li>
            <li>Results of free schools inspected as post-16 institutions are not included here. Post-16 free schools and some 14-19 free schools receive college inspections (learning and skills inspections, prior to September 2015). The Ofsted website does not allow details of post-16 inspections to be scraped as easily as those of school inspections, and, in the case of learning and skills inspections, inspection judgements were not directly comparable to those from school inspections. There are <span id="LSopenfreeschools"></span> open free schools that have had college/learning and skills inspections to date.</li>
            <li>Percentages may not total 100 due to rounding.</li>
        </ul>
        <h3>What's the point of it?</h3>
        <ul>
            <li>Currently it's not easy to get up-to-date information on Ofsted's assessment of a particular type of schools, such as free schools. This tool was built to try and help fill this gap.</li>
        </ul>
        <h3>What data is it based on?</h3>
        <ul>
            <li>Ofsted ratings: the <a class="redLink" href="http://reports.ofsted.gov.uk/">Ofsted website</a>.</li>
            <li>List of free schools, and free school details: <a class="redLink" href="http://www.education.gov.uk/edubase/home.xhtml">Edubase</a></li>
            <li>List of free schools, and free school details: the Department for Education’s <a class="redLink" href="https://get-information-schools.service.gov.uk/">get information about schools service</a>.</li>
        </ul>
        <h3>Who made the tool?</h3>
        <ul>
            <li>The tool has been developed by <a class="redLink" href="http://www.twitter.com/philipnye">Philip Nye</a>. If you make use of the tool, please provide attribution.</li>
            <li>While based on Ofsted data, it's not endorsed by the inspectorate.</li>
        </ul>
        <h3>How was the tool built?</h3>
        <ul>
            <li>See the links given <a class="redLink" href="https://github.com/philipnye/free-school-ofsted-ratings">here</a>.</li>
        </ul>
        <h3>Anything else I should know?</h3>
        <ul>
            <li>While every effort has been made to ensure that ratings listed here are accurate, with a number of checks carried out on the data, there's always the chance that an error could have crept into the results; no liability can be taken for anything you do with the data. So if you’re planning on using the results for anything business-critical I’d recommend that you check them directly on the Ofsted website.</li>
            <li>If you think a result is missing, or something is not accurate, or you want to provide feedback of any other kind, please get in touch via <a class="redLink" href="http://www.philipnye.co.uk/contact/">email</a> or <a class="redLink" href="http://www.twitter.com/philipnye/">Twitter</a>.</li>
        </ul>
        <span style="float:right"><a class="redLink" href="#headersSection">Back to the top</a></span>
    </div>

    <script type="text/javascript">

	    ////////////////////////////////////////
		//Importing data for headline figures///
		///////////////////////////////////////


	    d3.json("https://premium.scraperwiki.com/fkvwfha/7f269650903e4e1/sql/?q=select%20%0D%0A%20%20%20%20Max(Run_date)%2C%20Run_date_short%2CNumberOfSchools%2CNumberOfClosedSchools%2CNumberOfUnopenedSchools%2CNumberOfOpenUninspectedSchools%2CNumberOfOpenSec5Schools%2CNumberOfOpenLSSchools%0D%0Afrom%20admin_totals%0D%0Awhere%20Spreadsheet_pass%3D%22Pass%22%0D%0AAND%20Saving_pass%3D%22Pass%22", function(json) {             //this pulls in JSON feed of admin data for last successful run
	        data=json[0];           //json only has one row, so grabs that
	        d3.select("#lastUpdatedDate").text(data.Run_date_short);
	        d3.select("#openfreeschools").text(data.NumberOfOpenSec5Schools+data.NumberOfOpenUninspectedSchools+data.NumberOfOpenLSSchools);
	        d3.select("#sec5openfreeschools").text(data.NumberOfOpenSec5Schools);
	        d3.select("#LSopenfreeschools").text(data.NumberOfOpenLSSchools);
	    });



		//////////////////////////////
		//Importing data for tables///
		//////////////////////////////

		var openRatings = {}    //sets empty dictionary that will hold ratings details, so can be called globally
	    var closedRatings = {}    //sets empty dictionary that will hold ratings details, so can be called globally
	    var whereTable = ""
	    var whereNotes = ""

	    d3.json("https://premium.scraperwiki.com/fkvwfha/7f269650903e4e1/sql/?q=select%20%0D%0A%20%20%20%20published_recent%2C%20inspection_rating2%2C%20schooltype%2C%20LA%2C%20URL%2C%20schoolname_with_note_symbol%2C%20URN%2C%20schoolname%2C%20open_closed%2C%20opendate_full%2C%20inspection_date_long%2C%20inspection_rating%2C%20opendate_short%2C%20phase%2C%20publication_date%2C%20publication_date_long%2C%20include%2C%20notes%2C%20note_symbol%2C%20inspection_date%0D%0Afrom%20Last_successful_school_details%0D%0Awhere%20include%3D1%0D%0Aorder%20by%20inspection_rating2%2Cschoolname", function(json) {             //this pulls in the JSON feed of last successful school ratings, open schools only
	        openRatings=json;
	        whereTable="#openTableSpace"
	        whereNotes="#openNotesSpace"
	        drawTable(openRatings,whereTable)
	        writeNotes(openRatings,whereNotes);
	    });


	    d3.json("https://premium.scraperwiki.com/fkvwfha/7f269650903e4e1/sql/?q=select%20%0D%0A%20%20%20%20published_recent%2C%20inspection_rating2%2C%20schooltype%2C%20LA%2C%20URL%2C%20schoolname_with_note_symbol%2C%20URN%2C%20schoolname%2C%20open_closed%2C%20opendate_full%2C%20inspection_date_long%2C%20inspection_rating%2C%20opendate_short%2C%20phase%2C%20publication_date%2C%20publication_date_long%2C%20include%2C%20notes%2C%20note_symbol%2C%20inspection_date%0D%0Afrom%20Last_successful_school_details%0D%0Awhere%20open_closed%3D%22Closed%22%0D%0Aorder%20by%20inspection_rating2%2Cschoolname", function(json) {             //this pulls in the JSON feed of last successful school ratings, closed schools only
	        closedRatings=json;
	        whereTable="#closedTableSpace"
	        whereNotes="#closedNotesSpace"
	        drawTable(closedRatings,whereTable)
	        writeNotes(closedRatings,whereNotes);
	    });


	////////////////////////////////////////
	//Adding notes to explain table items///
	///////////////////////////////////////

		var writeNotes = function(ratings,whereNotes){
			var firstNote = true
			ratings.forEach(function(d){
				if (d.notes!=""){		//takes existing notes and adds on new note symbol + note
				 	if (firstNote==true){
				 		d3.select(whereNotes).html(d.note_symbol+d.notes)		//just the symbol and note, to prevent us getting an initial line break
				 	}
				 	else{
				 		d3.select(whereNotes).html(d3.select(whereNotes)[0][0].innerHTML+"<br>"+d.note_symbol+d.notes)		//set html in whereNotes ([0][0] just used to select single element in whereNotes) to be previous html + additional notes
				 	}
				 	firstNote=false;
				};
			})
		};



		//////////////////////////////////
		//Importing data for pie charts///
		/////////////////////////////////

		var ratingsData = {};
		var wherePie=""
		var pieSize=""
		var pieTitle=""

		d3.json("https://premium.scraperwiki.com/fkvwfha/7f269650903e4e1/sql/?q=select%20%0D%0A%20%20%20%20ID%2Cratingtype%2Cratingname%2C%20rating%2C%20percentage%2C%20ratingcount%0D%0Afrom%20Last_successful_ratings_summary%0D%0Awhere%20ratingtype%3D%22Overall%22%20AND%20percentage%3E0%0D%0Aorder%20by%20rating",function(error,json){
				if (error){
					console.log(error); //logs error in console if error occurs
				} else{
					ratingsData = json;
					wherePie="#openPieSpace"
					pieSize="large"
					pieTitle="Open free schools"
					makePie(ratingsData,wherePie,pieSize, pieTitle);
				}
			});

		d3.json("https://premium.scraperwiki.com/fkvwfha/7f269650903e4e1/sql/?q=select%20%0D%0A%20%20%20%20ID%2Cratingtype%2Cratingname%2C%20rating%2C%20percentage%2C%20ratingcount%0D%0Afrom%20Last_successful_ratings_summary%0D%0Awhere%20ratingtype%3D%22Primary%22%20AND%20percentage%3E0%0D%0Aorder%20by%20rating",function(error,json){
				if (error){
					console.log(error); //logs error in console if error occurs
				} else{
					ratingsData = json;
					wherePie="#primaryPieSpace"
					pieSize="small"
					pieTitle="Primary"
					makePie(ratingsData,wherePie,pieSize, pieTitle);
				}
			});

		d3.json("https://premium.scraperwiki.com/fkvwfha/7f269650903e4e1/sql/?q=select%20%0D%0A%20%20%20%20ID%2Cratingtype%2Cratingname%2C%20rating%2C%20percentage%2C%20ratingcount%0D%0Afrom%20Last_successful_ratings_summary%0D%0Awhere%20ratingtype%3D%22Secondary%22%20AND%20percentage%3E0%0D%0Aorder%20by%20rating",function(error,json){
				if (error){
					console.log(error); //logs error in console if error occurs
				} else{
					ratingsData = json;
					wherePie="#secondaryPieSpace"
					pieSize="small"
					pieTitle="Secondary"
					makePie(ratingsData,wherePie,pieSize, pieTitle);
				}
			});

		d3.json("https://premium.scraperwiki.com/fkvwfha/7f269650903e4e1/sql/?q=select%20%0D%0A%20%20%20%20ID%2Cratingtype%2Cratingname%2C%20rating%2C%20percentage%2C%20ratingcount%0D%0Afrom%20Last_successful_ratings_summary%0D%0Awhere%20ratingtype%3D%22All-through%22%20AND%20percentage%3E0%0D%0Aorder%20by%20rating",function(error,json){
				if (error){
					console.log(error); //logs error in console if error occurs
				} else{
					ratingsData = json;
					wherePie="#allThroughPieSpace"
					pieSize="small"
					pieTitle="All-through"
					makePie(ratingsData,wherePie,pieSize, pieTitle);
				}
			});

		d3.json("https://premium.scraperwiki.com/fkvwfha/7f269650903e4e1/sql/?q=select%20%0D%0A%20%20%20%20ID%2Cratingtype%2Cratingname%2C%20rating%2C%20percentage%2C%20ratingcount%0D%0Afrom%20Last_successful_ratings_summary%0D%0Awhere%20ratingtype%3D%22Alternative%20provision%22%20AND%20percentage%3E0%0D%0Aorder%20by%20rating",function(error,json){
				if (error){
					console.log(error); //logs error in console if error occurs
				} else{
					ratingsData = json;
					wherePie="#apPieSpace"
					pieSize="small"
					pieTitle="Alternative provision"
					makePie(ratingsData,wherePie,pieSize, pieTitle);
				}
			});

		d3.json("https://premium.scraperwiki.com/fkvwfha/7f269650903e4e1/sql/?q=select%20%0D%0A%20%20%20%20ID%2Cratingtype%2Cratingname%2C%20rating%2C%20percentage%2C%20ratingcount%0D%0Afrom%20Last_successful_ratings_summary%0D%0Awhere%20ratingtype%3D%22Special%22%20AND%20percentage%3E0%0D%0Aorder%20by%20rating",function(error,json){
				if (error){
					console.log(error); //logs error in console if error occurs
				} else{
					ratingsData = json;
					wherePie="#specialPieSpace"
					pieSize="small"
					pieTitle="Special"
					makePie(ratingsData,wherePie,pieSize, pieTitle);
				}
			});

	    ///////////////////////
		//Tables///////////////
		//////////////////////

	    var drawTable = function(ratings,whereTable){

		    var columnsToDisplay = ["schoolname_with_note_symbol", "URN", "LA", "phase", "inspection_date", "publication_date", "inspection_rating"];     //data headings, read when pulling in data
		    var columnTitles = [                                                                    //column headings, read when setting up table header
		        {"columnName":"Name ↑↓", "width":"242","type":"string","sorted":false,"selected":false},
		        {"columnName":"URN ↑↓", "width":"55","type":"string","sorted":false,"selected":false},
		        {"columnName":"Local authority ↑↓", "width":"140","type":"string","sorted":false,"selected":false},
		        {"columnName":"Phase ↑↓", "width":"106","type":"string","sorted":false,"selected":false},
		        {"columnName":"Inspection date ↑↓", "width":"96","type":"date","sorted":false,"selected":false},
		        {"columnName":"Publication date ↑↓", "width":"96","type":"date","sorted":false,"selected":false},
		        {"columnName":"Rating ↑↓", "width":"122","type":"rating","sorted":true,"selected":true}			//as by default, data is sorted on this column
		    ];

		    var table = d3.select(whereTable).append("table")					//manually sets column widths
		    	col= table.append("col").attr("width","242")					//name
		    	col= table.append("col").attr("width","66")						//URN
		    	col= table.append("col").attr("width","140")					//LA
		    	col= table.append("col").attr("width","106")					//phase
		    	col= table.append("col").attr("width","86")					//insp date
		    	col= table.append("col").attr("width","90")					//pub date
		    	col= table.append("col").attr("width","122")					//rating
		        thead = table.append("thead"),
		        tbody = table.append("tbody");

		    // append the header row
		    var headers = thead.append("tr")
		        .selectAll("th")
		        .data(columnTitles)
		        .enter()
		        .append("th")
		        .text(function(d) { return d.columnName; })
		        .attr("class",function(d){				/*sets class of header to selectedColumn for Rating column only*/
		        	var columnSelected
		        	if (d.selected==true){
		        		columnSelected="selectedColumn";
		        	}
		        	else if (d.selected==false){
		        		columnSelected="unselectedColumn";
		        	}
		        	return columnSelected;})
		        .on("click", function (d) {				/*sorts on clicked header, and updates class of clicked header to selectedColumn*/
		        	var columnSorted
		        	columnSorted=d.sorted
		        	for (i = 0; i < columnTitles.length; i++){
		        		columnTitles[i].sorted=false
		        		columnTitles[i].selected=false
		        		headers[0][i].className="unselectedColumn"
		        		if (headers[0][i].textContent==d.columnName){
		        			headers[0][i].className="selectedColumn";
		        		}
		        	}
		        	d.sorted=!columnSorted
		        	d.selected=true
		            if(d.columnName=="Name ↑↓"){
			            if(d.sorted == true){
			                rows.sort(function (b, a) { return b.schoolname.localeCompare(a.schoolname); });
			            }
			            else if(d.sorted == false){
			                rows.sort(function (a, b) { return b.schoolname.localeCompare(a.schoolname); });
			            }
		        	}
		            else if(d.columnName=="URN ↑↓"){
		      			if(d.sorted == true){
			                rows.sort(function (b, a) { return b.URN.localeCompare(a.URN); });
			            }
			            else if(d.sorted == false){
			                rows.sort(function (a, b) { return b.URN.localeCompare(a.URN); });
			            }
		            }
		            else if(d.columnName=="Local authority ↑↓"){
		      			if(d.sorted == true){
			                rows.sort(function (b, a) { return b.LA.localeCompare(a.LA); });
			            }
			            else if(d.sorted == false){
			                rows.sort(function (a, b) { return b.LA.localeCompare(a.LA); });
			            }
		            }
		            else if(d.columnName=="Phase ↑↓"){
		      			if(d.sorted == true){
			                rows.sort(function (b, a) { return b.phase.localeCompare(a.phase); });
			            }
			            else if(d.sorted == false){
			                rows.sort(function (a, b) {
			                	return b.phase.localeCompare(a.phase); });
			            }
		            }
		            else if(d.columnName=="Inspection date ↑↓"){
		      			if(d.sorted == true){
		      				rows.sort(function (a, b){return a.inspection_date_long<b.inspection_date_long ? -1 : a.inspection_date_long>b.inspection_date_long ? 1 : 0;});
			            }
			            else if(d.sorted == false){
			                rows.sort(function (a, b){return a.inspection_date_long>b.inspection_date_long ? -1 : a.inspection_date_long<b.inspection_date_long ? 1 : 0;});
			            }
		            }
		            else if(d.columnName=="Publication date ↑↓"){
		      			if(d.sorted == true){
		      				rows.sort(function (a, b){return a.publication_date_long<b.publication_date_long ? -1 : a.publication_date_long>b.publication_date_long ? 1 : 0;});
			            }
			            else if(d.sorted == false){
			                rows.sort(function (a, b){return a.publication_date_long>b.publication_date_long ? -1 : a.publication_date_long<b.publication_date_long ? 1 : 0;});
			            }
		            }
		            else if(d.columnName=="Rating ↑↓"){
		      			if(d.sorted == true){
			                rows.sort(function (b, a) { return b.inspection_rating2.localeCompare(a.inspection_rating2); });
			            }
			            else if(d.sorted == false){
			                rows.sort(function (a, b) { return b.inspection_rating2.localeCompare(a.inspection_rating2); });
			            }
		            }
		        });

		    // create a row for each object in the data
		    var rows = tbody.selectAll("tr")
		        .data(ratings)
		        .enter()
		        .append("tr")

		    //create a cell in each row for each column
		    var cells = rows.selectAll("td")
		        .data(function(d) {
		            return columnsToDisplay.map(function(column) {              //for all cells, creates an object with column, value and URN (note that not all of these need to be displayed)
		                return {column: column, value: d[column],URN:d["URN"]};
		            });
		        })
		        .enter()
		        .append("td")
		        .html(function(d,i){              //when dealing with column "Name", add a hyperlink. When  dealing with other columns, just return the data value
		            if (d.column=="schoolname_with_note_symbol"){
		                return "<a href=\"http://www.ofsted.gov.uk/inspection-reports/find-inspection-report/provider/ELS/" + d.URN +"\"" + "target='_blank'>" + d.value + "</a>";
		            }
		            else{
		                return d.value;
		            }
		        });
			};


		///////////////////////
		//Summary pie chart///
		//////////////////////


			var makePie = function(ratingsData,wherePie,pieSize,pieTitle){
				if (pieSize=="large"){
		        	var canvasWidth = 320,
					    canvasHeight = 320,
					    radius = Math.min(canvasWidth, canvasHeight) / 2;
		        }
		        else if (pieSize=="small"){
		        	var canvasWidth = 160,
				    	canvasHeight = 160,
				    	radius = Math.min(canvasWidth, canvasHeight) / 2;
		        }

				var arc = d3.svg.arc()
				    .outerRadius(radius - 20)
				    .innerRadius(canvasHeight/6);

				var pie = d3.layout.pie()
				    .sort(null)
				    .value(function(d) { return d.percentage; });

				var svg = d3.select(wherePie).append("svg")			//draws canvas, and sets our default position to being in the centre of the canvas
				    .attr("width", canvasWidth)
				    .attr("height", canvasHeight)
				  	.append("g")
				    .attr("transform", "translate(" + canvasWidth / 2 + "," + canvasHeight / 2 + ")");

				var colours = {
					"Outstanding":"#1B811D",
					"Good":"#4BBD4D",
					"Requires improvement":"#ED9004",
					"Inadequate":"#B00808"
				};

   		 		var openInspectedTotal = 0;
				ratingsData.forEach(function(d){ openInspectedTotal+=(d.ratingcount*1); });

				var	center_group=svg.selectAll('text')				//adds central label
						.data(ratingsData)							//unnecessarily adds the label four times
						.enter()
						.append('text')
						.text(openInspectedTotal)
						.attr("font-weight", "bold")
						.attr('class',"centralLabel"+pieSize)		//pieSize later used to set font size
						.attr('dy', function(d){ 					//bumps text down a few pixels to account for fact text sits on x line
							if (pieSize=="large"){
							return 6}
							else if (pieSize=="small"){
							return 2}
						})
						.attr('text-anchor', 'middle');

				var g = svg.selectAll(".arc")
				    .data(pie(ratingsData))
				    .enter()
				    .append("g")
				    .attr("class", "arc");

				g.append("path")
				    .attr("d", arc)
				    .style("fill", function(d) { return colours[d.data.ratingname]; });

				g.append("text")									//labels each segment with the relevant count
					.attr("transform", function(d) {return "translate(" + arc.centroid(d) + ")";})
				    .attr("text-anchor", "middle")
				    .attr("font-weight", "bold")
				    .attr("class", "segmentCount"+pieSize)			//pieSize later used to set font size
				    .text(function(d) { return d.data.ratingcount})

				g.append("text")									//labels each segment with the relevant percentage
					.attr("transform", function(d) {return "translate(" + arc.centroid(d) + ")";})
				    .attr("dx", "2")
				    .attr('dy', function(d){ 					//shunted down a little from segment count
						if (pieSize=="large"){
						return 18}
						else if (pieSize=="small"){
						return 12}
					})
				    .attr("text-anchor", "middle")
				    .attr("class", "segmentPercentage"+pieSize)		//pieSize later used to set font size
				    .text(function(d) { return " "+d.data.percentage+"%"})

				svg.append("text")								//header for each chart
				    .attr("dy", (-canvasHeight/2)+14)
				    .attr("font-weight", "bold")
				    .attr("text-anchor", "middle")
				    .attr("class", "chartHeader")
				    .text(pieTitle)
			};


		///////////////////////
		//Key/////////////////
		//////////////////////

		var makeKey = function(){
				var canvasWidth = 260,								//hacky solution to push 'special' pie chart onto a new line
				    canvasHeight = 160

			var svg = d3.select("#keySpace").append("svg")			//draws canvas, and sets our default position to being in the centre of the canvas
				.attr("width", canvasWidth)
				.attr("height", canvasHeight)


			keyData=[
		        {"Name":"Outstanding", "colour":"#1B811D"},
		        {"Name":"Good", "colour":"#4BBD4D"},
		        {"Name":"Requires improvement", "colour":"#ED9004"},
		        {"Name":"Inadequate", "colour":"#B00808"},
		    ];

			svg.selectAll("rect")
				.data(keyData)
				.enter()
				.append("rect")
				.attr("y",function(d,i){return (i*21)+20;})
				.attr("width",100)
				.attr("height",20)
				.style("fill", function(d) { return d.colour });

			svg.selectAll("text")
				.data(keyData)
				.enter()
				.append("text")
				.attr("x",105)									// left edge of key segment + segment width + 5px
				.attr("y",function(d,i){return (i*21)+15+20;})
				.text(function(d) { return d.Name })

		}

		makeKey();		//runs they key production section


</script>

  </body>
</html>
